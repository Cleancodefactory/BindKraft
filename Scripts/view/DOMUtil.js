var DOMUtil={};DOMUtil.$defaultTrimRegEx=/^\s*(.*?)\s*$/;DOMUtil.trim=function(str,re){var tre=re||DOMUtil.$defaultTrimRegEx;if(str!=null){var m=tre.exec(str);if(m!=null){return m[1];}}return str;};DOMUtil.addToken=function(str,tkn,retkn,delim){retkn=retkn||/\S+/g;delim=delim||" ";var str_tokens=(str||"").match(retkn)||[];var tkn_tokens=(tkn||"").match(retkn)||[];var result=str||"";var i,j;for(var j=0;j<tkn_tokens.length;j++){for(i=0;i<str_tokens.length;i++){if(str_tokens[i]==tkn_tokens[j])break;}if(i>=str_tokens.length)result+=delim+tkn_tokens[j];}return this.trim(result);};DOMUtil.removeToken=function(str,tkn,retkn,delim){retkn=retkn||/\S+/g;delim=delim||" ";var str_tokens=(str||"").match(retkn)||[];var tkn_tokens=(tkn||"").match(retkn)||[];var result="";var j;for(var i=0;i<str_tokens.length;i++){for(j=0;j<tkn_tokens.length;j++){if(str_tokens[i]==tkn_tokens[j])break;}if(j>=tkn_tokens.length)result+=delim+str_tokens[i];}return this.trim(result);};DOMUtil.countToken=function(str,tkn,retkn,delim){retkn=retkn||/\S+/g;delim=delim||" ";var str_tokens=(str||"").match(retkn)||[];var tkn_tokens=(tkn||"").match(retkn)||[];var result=0;var j;for(var i=0;i<str_tokens.length;i++){for(j=0;j<tkn_tokens.length;j++){if(str_tokens[i]==tkn_tokens[j]){result++;break;};}}return result;};DOMUtil.toggleToken=function(str,tkn,retkn,delim){retkn=retkn||/\S+/g;delim=delim||" ";var found=false;var str_tokens=(str||"").match(retkn)||[];var tkn_tokens=(tkn||"").match(retkn)||[];var result="";for(var i=0;i<tkn_tokens.length;i++){found=false;for(var j=0;j<str_tokens.length;j++){if(str_tokens[j]==tkn_tokens[i]){str_tokens.splice(j,1);found=true;break;}}if(!found)result+=delim+tkn_tokens[i];}var _r="";for(var j=0;j<str_tokens.length;j++)_r+=delim+str_tokens[j];return this.trim(_r+result);};DOMUtil.addClass=function(el,cls){if(el!=null){el.className=DOMUtil.addToken(el.className,cls);return el.className;}};DOMUtil.removeClass=function(el,cls){if(el!=null){el.className=DOMUtil.removeToken(el.className,cls);return el.className;}};DOMUtil.countClass=function(el,cls){if(el!=null){return DOMUtil.countToken(el.className,cls);}return 0;};DOMUtil.toggleClass=function(el,cls){if(el!=null){el.className=DOMUtil.toggleToken(el.className,cls);return el.className;}};DOMUtil.attr=function(el,attrname,val){if(el instanceof HTMLElement&&typeof attrname=="string"){if(arguments.length>2){if(val==null){el.removeAttribute(attrname);}else{el.setAttribute(attrname,val);}return val;}else{var r=null;if(el.hasAttribute(attrname)){r=el.getAttribute(attrname);if(r==null)return"";return r;}}}return null;};DOMUtil.getAttributes=function(el,pattern){var i,attr;if(el instanceof Element){var re=null,obj={};if(typeof pattern=="string"){re=new RegExp(pattern);}else if(pattern instanceof RegExp){re=pattern;}else if(pattern!=null){throw"Argument pattern must either null, string pattern or predefined RegExp (non-global)";}var attrs;if(re==null){attrs=el.attributes;for(i=0;i<attrs.length;i++){attr=attrs[i];obj[attr.name]=attr.value;}}else{if(re.global)re=new RegExp(re.source);attrs=el.attributes;var match;for(i=0;i<attrs.length;i++){attr=attrs[i];re.lastIndex=0;match=re.exec(attr.name);if(match!=null){if(match.length>1&&match[1]!=null&&match[1].length>0){obj[match[1]]=attr.value;}else{obj[match[0]]=attr.value;}}}}return obj;}else if(el instanceof NodeList||el instanceof HTMLCollection){var oattrs,_arr=[];for(i=0;i<el.length;i++){oattrs=DOMUtil.getAttributes(el[i],pattern);if(BaseObject.is(oattrs,"object")){_arr.push(oattrs);}}return _arr;}return null;};DOMUtil.arrayFrom=function(nodes){var i,arr=[];if(nodes instanceof NodeList||nodes instanceof HTMLCollection){for(i=0;i<nodes.length;i++){if(nodes[i]instanceof HTMLElement){arr.push(nodes[i]);}}}return arr;};DOMUtil.detach=function(node){var i;if(node instanceof HTMLElement){if(node.parentElement instanceof HTMLElement){try{return node.parentElement.removeChild(node);}catch(e){return node;}}}else if(node instanceof NodeList||node instanceof HTMLCollection){var nodes=DOMUtil.arrayFrom(node);for(i=0;i<nodes.length;i++){DOMUtil.detach(nodes[i]);}return node;}return node;};DOMUtil.$obliterateDom=function(dom){var arr;if(dom instanceof HTMLElement){arr=JBUtil.domrefproperties.split(",");for(var i=0;i<arr.length;i++){BaseObject.obliterate(dom[arr[i].trim()]);}if(JBUtil.domdestructors!=null){for(var k in JBUtil.domdestructors){if(typeof JBUtil.domdestructors[k]=="function"){JBUtil.domdestructors[k](dom);}}}}else if(dom instanceof HTMLCollection||dom instanceof NodeList){arr=DOMUtil.arrayFrom(dom);for(var i=0;i<arr.length;i++){this.$obliterateDom(arr[i]);}}};DOMUtil.obliterateDom=function(dom,bAndSelf){var i;if(dom instanceof HTMLElement){for(i=0;i<dom.childNodes.length;i++){var node=dom.childNodes[i];if(node instanceof HTMLElement){DOMUtil.obliterateDom(node,true);}}if(bAndSelf){DOMUtil.$obliterateDom(dom);}}else if(dom instanceof HTMLCollection||dom instanceof NodeList){for(i=0;i<dom.length;i++){DOMUtil.obliterateDom(dom[i],bAndSelf);}}};DOMUtil.empty=function(dom){var i;if(dom instanceof HTMLElement){while(dom.firstChild){dom.removeChild(dom.firstChild);}}else if(dom instanceof HTMLCollection||dom instanceof NodeList){var arr=Array.createCopyOf(dom);for(i=0;i<arr.length;i++){DOMUtil.empty(arr[i]);}}};DOMUtil.Empty=function(dom){DOMUtil.obliterateDom(dom);DOMUtil.empty(dom);};DOMUtil.remove=function(dom){var i;DOMUtil.empty(dom);if(dom instanceof HTMLElement){DOMUtil.detach(dom);}else if(dom instanceof HTMLCollection||dom instanceof NodeList){var arr=Array.createCopyOf(dom);for(i=0;i<arr.length;i++){DOMUtil.remove(arr[i]);}}};DOMUtil.Remove=function(dom){DOMUtil.obliterateDom(dom);DOMUtil.remove(dom);};DOMUtil.ownText=function(dom){var i;if(dom instanceof HTMLElement){var s="";for(i=0;i<dom.childNodes.length;i++){if(dom.ChildNodes[i].nodeType==3){s+=dom.ChildNodes[i].textContent;}}return s;}else if(dom instanceof Node){return dom.textContent;}else if(dom instanceof NodeList||dom instanceof HTMLCollection||BaseObject.is(dom,"Array")){var s="";for(i=0;i<dom.length;i++){if(dom[i]instanceof HTMLElement){s+=this.ownText(dom[i]);}}return s;}return"";};DOMUtil.clearTextNodes=function(dom,depth){depth=depth||0;var i;if(dom instanceof HTMLElement){var nodes=[];for(i=0;i<dom.childNodes.length;i++){if(dom.childNodes[i].nodeType==3){nodes.push(dom.childNodes[i]);}}for(i=nodes.length-1;i>=0;i--){try{dom.removeChild(nodes[i]);}catch(e){}}depth--;if(depth<0)return;for(i=0;i<dom.childNodes.length;i++){if(dom instanceof HTMLElement){this.clearTextNodes(dom.childNodes[i],depth-1);}}}else if(dom instanceof NodeList||dom instanceof HTMLCollection||BaseObject.is(dom,"Array")){for(i=0;i<dom.length;i++){if(dom[i]instanceof HTMLElement){this.clearTextNodes(dom[i],depth);}}}};DOMUtil.setTextWithElements=function(dom,text){if(dom instanceof HTMLElement){DOMUtil.clearTextNodes(dom,0);if(typeof text=="string"){var res=String.parseSplit(text,/\{(?:(\w+):)?(\d+)\}/g,function(o){var x,tag,nodematch;if(o.separator!=null){if(o.separator[1]!=null){tag=o.separator[1];x=parseInt(o.separator[2],10);nodematch=-1;for(var i=0;i<dom.childNodes.length;i++){if(dom.childNodes[i].tagName&&dom.childNodes[i].tagName.toLowerCase()==tag){nodematch++;if(nodematch==x){return dom.childNodes[i];}}}return null;}else{x=parseInt(o.separator[2],10);if(x>=0&&x<dom.childNodes.length){return dom.childNodes[x];}else{return null;}}}else{return null;}});if(res.length>0){for(var j=0;j<res.length;j++){var r=res[j];if(r.separator==null){dom.appendChild(document.createTextNode(r.part));}else if(r.separator instanceof HTMLElement){dom.insertBefore(document.createTextNode(r.part),r.separator);}}}else{dom.textContent=text;}}}else if(dom instanceof NodeList||dom instanceof HTMLCollection||BaseObject.is(dom,"Array")){for(i=0;i<dom.length;i++){if(dom[i]instanceof HTMLElement){this.setTextWithElements(dom[i],text);}}}};DOMUtil.matchesSelector=function(dom,selector){var i;if(dom instanceof HTMLElement){if(typeof selector=="string"){if(dom.matches(selector))return true;}else if(BaseObject.is(selector,"Array")){for(i=0;i<selector.length;i++){if(dom.matches(selector[i]))return true;}}return false;}else if(dom instanceof NodeList||dom instanceof HTMLCollection||BaseObject.is(dom,"Array")){for(i=0;i<dom.length;i++){if(dom[i]instanceof HTMLElement){if(!this.matchesSelector(dom[i],selector))return false;}}return true;}};DOMUtil.filterElements=function(dom,selector,elType){var _ElementType=elType||HTMLElement;if(dom instanceof _ElementType){if(selector==null||dom.matches(selector)){return dom;}}else if(dom instanceof NodeList||dom instanceof HTMLCollection||BaseObject.is(dom,"Array")){var el,result=[];for(var i=0;i<dom.length;i++){if(dom[i]instanceof _ElementType){el=this.filterElements(dom[i],selector,_ElementType);if(el)result.push(el);}}return result;}return null;};DOMUtil.cloneElements=function(dom,elType){var _ElementType=elType||HTMLElement;if(dom instanceof _ElementType){return dom.cloneNode(true);}else if(dom instanceof NodeList||dom instanceof HTMLCollection||BaseObject.is(dom,"Array")){var el,result=[];for(var i=0;i<dom.length;i++){if(dom[i]instanceof _ElementType){el=this.cloneElements(dom[i],_ElementType);if(el)result.push(el);}}return result;}return null;};DOMUtil.findElements=function(dom,selector,callback,_result,_nonroot){var result=_result||[];var b;var inroot=_nonroot?false:true;if(dom instanceof HTMLElement){b=null;if(callback!=null&&(b=callback(dom,inroot))===false)return result;if(dom.matches(selector)){result.push(dom);}if(b===true)return result;if(dom.children!=null&&dom.children.length>0){DOMUtil.findElements(dom.children,selector,callback,result,true);}}else if(dom instanceof HTMLCollection||dom instanceof NodeList||BaseObject.is(dom,"Array")){for(var i=0;i<dom.length;i++){DOMUtil.findElements(dom[i],selector,callback,result);}}else if(dom instanceof Document){return DOMUtil.findElements(dom.body,selector,callback);}return result;};DOMUtil.findElement=function(dom,selector,callback,_nonroot){var el;var b;var inroot=_nonroot?false:true;if(dom instanceof HTMLElement){b=null;if(callback!=null&&(b=callback(dom,inroot))===false)return null;if(dom.matches(selector)){return dom;}if(b===true)return null;if(dom.children!=null&&dom.children.length>0){return DOMUtil.findElement(dom.children,selector,callback,true);}return null;}else if(dom instanceof HTMLCollection||dom instanceof NodeList||BaseObject.is(dom,"Array")){for(var i=0;i<dom.length;i++){el=DOMUtil.findElement(dom[i],selector,callback);if(el!=null)return el;}}else if(dom instanceof Document){return DOMUtil.findElement(dom.body,selector,callback);}return null;};DOMUtil.findParent=function(dom,selector,callback){var b;if(dom instanceof HTMLElement){b=null;if(callback!=null&&(b=callback(dom))===false)return null;if(dom.matches(selector)){return dom;}if(b===true)return null;var p=dom.parentElement;while(p!=null&&p instanceof HTMLElement){b=null;if(callback!=null&&(b=callback(dom))===false)return null;if(p.matches(selector))return p;p=p.parentElement;if(b===true)return null;}}return null;};DOMUtil.fragmentFromHTML=function(html,bNoFilter){var fr=document.createDocumentFragment();var div=document.createElement("div");fr.appendChild(div);div.innerHTML=html;var r=document.createDocumentFragment();var n;while(n=div.firstChild){if(n instanceof HTMLElement||bNoFilter){r.appendChild(n);}else{div.removeChild(n);}}return r;};DOMUtil.fragmentFromCollection=function(coll,bClone){if(coll instanceof HTMLCollection||coll instanceof NodeList||BaseObject.is(coll,"Array")){var fr=document.createDocumentFragment();for(var i=coll.length;i>=0;i--){if(coll[i]instanceof HTMLElement){if(bClone){fr.insertBefore(coll[i].cloneNode(true),fr.firstChild);}else{fr.insertBefore(coll[i],fr.firstChild);}}}return fr;}return null;};DOMUtil.cleanupDOMFragment=function(frg){var i;if(frg instanceof DocumentFragment){var nodes=[];for(i=0;i<frg.childNodes.length;i++)nodes.push(frg.childNodes[i]);for(i=0;i<nodes.length;i++){if(!(nodes[i]instanceof HTMLElement)){try{frg.removeChild(nodes[i]);}catch(ex){}}}}return frg;};DOMUtil.queryAllByDataKey=function(node,datakey){return DOMUtil.findElements(node,'[data-key="'+datakey+'"]',DOMUtil.BorderCallbacks.DataKeysInViewIn);};DOMUtil.queryOneByDataKey=function(node,datakey){return DOMUtil.findElement(node,'[data-key="'+datakey+'"]',DOMUtil.BorderCallbacks.DataKeysInViewIn);};DOMUtil.queryOne=function(node,selector){if(arguments.length>1){return DOMUtil.findElement(node,selector,DOMUtil.BorderCallbacks.DataKeysInViewIn);}else{selector=node;return DOMUtil.findElement(document.body,selector,DOMUtil.BorderCallbacks.DataKeysInViewIn);}};DOMUtil.queryAll=function(node,selector){if(arguments.length>1){return DOMUtil.findElements(node,selector,DOMUtil.BorderCallbacks.DataKeysInViewIn);}else{selector=node;return DOMUtil.findElements(document.body,selector,DOMUtil.BorderCallbacks.DataKeysInViewIn);}};DOMUtil.parentByDataKey=function(node,datakey){return DOMUtil.findParent(node,'[data-key="'+datakey+'"]',DOMUtil.BorderCallbacks.DataKeysInViewOut);};DOMUtil.queryForMainSlot=function(node){return DOMUtil.findElement(node,'[data-key="_client"]',DOMUtil.BorderCallbacks.DataKeysInViewOut);};DOMUtil.querySlots=function(node){var result={main:null,named:{},nonamed:true};var el=DOMUtil.findElement(node,'[data-key="_client"]',DOMUtil.BorderCallbacks.DataKeysInViewOut);if(el!=null)result.main=el;var arr=DOMUtil.findElements(node,'[data-sys-client="true"]',DOMUtil.BorderCallbacks.WindowSlotsIn);var n;el=null;for(var i=0;i<arr.length;i++){el=arr[i];if(arr[i].matches('[data-key]')){n=arr[i].getAttribute("data-key");if(typeof n=="string"){if(n!="_client"){result.nonamed=false;result.named[n]=arr[i];}}}else{if(result.main==null){result.main=arr[i];}}}if(result.main==null)result.main=el;return result;};DOMUtil.BorderIndicator={templateRoot:function(node){if(JBUtil.isTemplateRoot(node))return true;},controlRoot:function(node){return BaseObject.is(node.activeClass,"IUIControl");},dataContextRoot:function(node){return node.dataContext!=null||node.hasDataContext;}};DOMUtil.BorderCallbacks={WindowSlotsIn:function(node,inroot){var indicator=DOMUtil.BorderIndicator;if(indicator.templateRoot(node)&&!inroot)return false;if(indicator.controlRoot(node))return false;},DataKeysInViewIn:function(node,inroot){var indicator=DOMUtil.BorderIndicator;if(indicator.templateRoot(node)&&!inroot)return false;if(indicator.controlRoot(node)&&!inroot)return true;},DataKeysInViewOut:function(node,inroot){var indicator=DOMUtil.BorderIndicator;if(indicator.templateRoot(node))return true;if(indicator.controlRoot(node))return true;}};DOMUtil.toDOMElement=function(inp){var i;if(BaseObject.isJQuery(inp)){if(inp.length>=1){return inp.get(0);}else{return null;}}else if(inp instanceof HTMLElement){return inp;}else if(inp instanceof HTMLCollection||inp instanceof NodeList){if(inp.length>0){return inp[0];}}if(window.DOMMNode&&inp instanceof DOMMNode){return inp._node;}return null;};DOMUtil.toDOMM=function(inp){if(!window.DOMMNode)return null;var i,arr;if(BaseObject.isJQuery(inp)){arr=[];if(inp.length==1){return new DOMMNode(inp.get(0));}else{for(i=0;i<inp.length;i++){arr.push(inp.get(i));}return new DOMMCollection(arr);}}else if(inp instanceof HTMLElement){return new DOMMNode(inp);}else if(inp instanceof HTMLCollection||inp instanceof NodeList){arr=[];for(i=0;i<inp.length;i++){arr.push(inp[i]);}return new DOMMCollection(arr);}else{return new DOMMCollection();}};