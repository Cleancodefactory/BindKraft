function AsyncResult(){BaseObject.apply(this,arguments);for(var i=0;i<arguments.length;i++){var arg=arguments[i];if(BaseObject.is(arg,"IProcessScheduler")){this.$scheduler=arg;}else if(BaseObject.is(arg,"IDispatchable")){this.set_task(arg);}else if(BaseObject.is(arg,"IInvoke")||typeof arg=="function"){this.completedevent.add(arg);}}}AsyncResult.Inherit(BaseObject,"AsyncResult");AsyncResult.Implement(IAsyncResult);AsyncResult.prototype.traceOn=false;AsyncResult.prototype.obliterate=function(bFull){if(this.isScheduled)this.unschedule();BaseObject.prototype.obliterate.call(this,bFull);};AsyncResult.prototype.$set_executing=function(v){if(this.traceOn){if(v){jbTrace.log("Entering executing state - async result: "+this.$__instanceId+" system tick:"+Ticker.Default.get_totalticks(),0xFFF404);}else{jbTrace.log("Leaving executing state - async result: "+this.$__instanceId+" system tick:"+Ticker.Default.get_totalticks(),0xFFF404);}}this.$executing=v;};AsyncResult.prototype.isCompleted=function(){if(this.$chainedResults!=null&&this.$chainedResults.length>0)return false;if(!this.$isThisCompleted)return false;return true;};AsyncResult.prototype.$isThisCompleted=false;AsyncResult.prototype.isSingleCompleted=function(){return this.$isThisCompleted;};AsyncResult.prototype.completedevent=new InitializeEvent("Fired when the operation completes. This will include child operations if the result is chained");AsyncResult.prototype.singlecompletedevent=new InitializeEvent("Fired when this operation completes. Does not include chained operation (if the result is chained)");AsyncResult.prototype.then=function(handler_or_this,handler_or_nothing){if(this.traceOn)jbTrace.log("Adding completion handler to async result: "+this.$__instanceId+" system tick:"+Ticker.Default.get_totalticks(),0xFFF404);if(typeof handler_or_nothing=="function"&&BaseObject.is(handler_or_this,"BaseObject")){this.completedevent.add(new Delegate(handler_or_this,handler_or_nothing));}else{this.completedevent.add(handler_or_this);}return this;};AsyncResult.prototype.setComplete=function(data){if(this.traceOn)jbTrace.log("Set complete invoked on Async result: "+this.$__instanceId+" system tick:"+Ticker.Default.get_totalticks()+" current state is "+(this.$isThisCompleted?"COMPLETED":"not completed"),0xFFF404);if(!this.$isThisCompleted){if(this.traceOn)jbTrace.log("Completed Async result: "+this.$__instanceId+" system tick:"+Ticker.Default.get_totalticks(),0xFFF404);this.$isThisCompleted=true;this.singlecompletedevent.invoke(this,data);this.singlecompletedevent.removeAll();if(this.$chainedResults.length==0){if(this.traceOn)jbTrace.log("* Everything completed on Async result: "+this.$__instanceId+" system tick:"+Ticker.Default.get_totalticks(),0xFFF404);this.completedevent.invoke(this,data);this.completedevent.removeAll();}}this.$isThisCompleted=true;this.isScheduled=false;this.$adviseOwner(this.isScheduled);};AsyncResult.prototype.$chainedResultComplete=function(sender,data){this.$chainedResults.removeElement(sender);if(this.traceOn)jbTrace.log("chained result reported in on Async result: "+this.$__instanceId,0xFFF404);if(this.traceOn)jbTrace.log("Unchaining result #"+(this.$chainedResults.length+1)+" on Async result: "+this.$__instanceId+" system tick:"+Ticker.Default.get_totalticks(),0xFFF404);if(this.$chainedResults.length==0){if(this.$isThisCompleted){if(this.traceOn)jbTrace.log("* Everything completed on Async result: "+this.$__instanceId+" system tick:"+Ticker.Default.get_totalticks(),0xFFF404);this.completedevent.invoke(this,data);this.completedevent.removeAll();}}};AsyncResult.prototype.$chainedResults=new InitializeArray();AsyncResult.prototype.chainResult=function(aresult){if(BaseObject.is(aresult,"IAsyncResult")){if(this.$chainedResults.addElement(aresult)){if(this.traceOn)jbTrace.log("Chaining result #"+this.$chainedResults.length+" on Async result: "+this.$__instanceId+" system tick:"+Ticker.Default.get_totalticks(),0xFFF404);aresult.completedevent.add(new Delegate(this,this.$chainedResultComplete));}}};AsyncResult.prototype.unchainResult=function(aresult){if(BaseObject.is(aresult,"IAsyncResult")){if(this.$chainedResults.removeElement(aresult)){if(this.traceOn)jbTrace.log("Unchaining result #"+(this.$chainedResults.length+1)+" on Async result: "+this.$__instanceId+" system tick:"+Ticker.Default.get_totalticks(),0xFFF404);aresult.completedevent.remove(new Delegate(this,this.$chainedResultComplete));}}};AsyncResult.prototype.get_scheduler=function(){return this.$scheduler;};AsyncResult.prototype.set_scheduler=function(v){if(v!=null&&!BaseObject.is(v,"IProcessScheduler"))throw"Invalid argument";this.$scheduler=v;};AsyncResult.prototype.$scheduleDependentPending=function(){if(this.$scheduler!=null&&this.$pendingScheduleTasks!=null){for(var i=0;i<this.$pendingScheduleTasks.length;i++){var _args=this.$pendingScheduleTasks[i];if(BaseObject.is(_args,"Array")){var args=Array.createCopyOf(_args,1);args.unshift(_args[0],this);var ar=this.$scheduler.schedule.apply(this.$scheduler,args);}}this.$pendingScheduleTasks=null;}};AsyncResult.prototype.$unscheduleDependent=function(){if(this.$chainedResults!=null&&this.$chainedResults.length>0){for(var i=0;i<this.$chainedResults.length;i++){var task=this.$chainedResults[i];if(BaseObject.is(task,"IAsyncResult")){if(this.traceOn)jbTrace.log("Unscheduling chained result #"+(i+1)+" on Async result: "+this.$__instanceId+" system tick:"+Ticker.Default.get_totalticks(),0xFFF404);task.completedevent.remove(new Delegate(this,this.$chainedResultComplete));task.unschedule();}}this.$chainedResults.length=0;}};AsyncResult.prototype.scheduleDependent=function(task){var ar=null;if(this.$pendingScheduleTasks==null)this.$pendingScheduleTasks=[];this.$pendingScheduleTasks.push(Array.createCopyOf(arguments));if(this.$scheduler!=null&&this.isScheduled){this.$scheduleDependentPending();}return this;};AsyncResult.prototype.$adviseOwner=function(bScheduled){if(bScheduled){if(BaseObject.is(this.ownerObject,"BaseObject"))this.ownerObject.$asyncResultWasScheduled(this);}else{if(BaseObject.is(this.ownerObject,"BaseObject"))this.ownerObject.$asyncResultWasUnscheduled(this);}};AsyncResult.prototype.set_scheduled=function(v){this.isScheduled=v;this.$adviseOwner(this.isScheduled);if(v){this.$scheduleDependentPending();}else{this.$unscheduleDependent();}};AsyncResult.prototype.notify=function(){var self=this;return function(){self.setComplete.apply(self,arguments);};};AsyncResult.prototype.schedule=function(){if(!this.isScheduled){if(this.$scheduler!=null){if(this.traceOn)jbTrace.log("(self) Scheduling Async result: "+this.$__instanceId+" system tick:"+Ticker.Default.get_totalticks(),0xFFF404);var args=Array.createCopyOf(arguments);if(args.length>0&&!BaseObject.is(args[0],"IAsyncResult")){args.unshift(null);}args.unshift(this);this.$scheduler.schedule.apply(this.$scheduler,args);}}else{}};AsyncResult.prototype.unschedule=function(){if(this.isScheduled){if(this.$scheduler!=null){if(this.traceOn)jbTrace.log("(self) Unscheduling Async result: "+this.$__instanceId+" system tick:"+Ticker.Default.get_totalticks(),0xFFF404);this.$scheduler.unschedule(this);this.completedevent.removeAll();this.singlecompletedevent.removeAll();}}};