function BKUrlPath(pathstr,bdecode,bencode){BKUrlObjectBaseChild.apply(this,arguments);this.set_source(pathstr);if(bencode===true||bencode===false){this.set_encode(bencode);}}BKUrlPath.Inherit(BKUrlObjectBaseChild,"BKUrlPath");BKUrlPath.prototype.$pathparts=new InitializeArray("All path parts - segments");BKUrlPath.prototype.$abs=false;BKUrlPath.prototype.$hasfilepart=false;BKUrlPath.prototype.get_segementscount=function(){return this.$pathparts.length;};BKUrlPath.prototype.get_pathnamesegementscount=function(){if(!this.$hasfilepart){return this.$pathparts.length;}else{var c=this.$pathparts.length;return c>=0?c:0;}};BKUrlPath.prototype.get_allsegments=function(){return Array.createCopyOf(this.$pathparts);};BKUrlPath.prototype.get_pathnamesegements=function(){var s=[];for(var i=0;i<this.$pathparts.length;i++){if(i==this.$pathparts.length-1){if(!this.$hasfilepart){s.push(this.$pathparts[i]);}}else{s.push(this.$pathparts[i]);}}return s;};BKUrlPath.prototype.get_hasfilepart=function(){if(this.$pathparts!=null&&this.$pathparts.length>0){return this.$hasfilepart;}return false;};BKUrlPath.prototype.get_absolute=function(){if(this.get_parent()!=null&&this.get_parent().get_authority()!=null&&!this.get_parent().get_authority().get_isempty()){return true;}return this.$abs;};BKUrlPath.prototype.set_absolute=function(v){this.$abs=v?true:false;};BKUrlPath.prototype.get_isempty=function(){if(this.$pathparts==null||this.$pathparts.length==0){if(!this.$abs)return true;}return false;};BKUrlPath.prototype.$combine=function(v){if(v.get_isempty())return true;if(v.get_absolute()){this.$pathparts=Array.createCopyOf(v.$pathparts);this.$abs=v.$abs;this.$hasfilepart=v.$hasfilepart;return true;}else{if(this.$hasfilepart&&this.$pathparts.length>0){this.$pathparts.pop();this.$hasfilepart=false;}this.$pathparts.push.apply(this.$pathparts,v.$pathparts);this.$hasfilepart=v.$hasfilepart;return true;}};BKUrlPath.prototype.clear=function(){this.$pathparts.splice(0,this.$pathparts.length);this.$abs=false;this.$hasfilepart=false;};BKUrlPath.$reParsePath=/(?:(?:^(\/*)([^\/]*))|(?:(\/+)([^\/]*)))/gi;BKUrlPath.$reSegment=/^(?:[A-Za-z0-9\-\._~]|%[A-Za-z0-9]{2}|[!$&'()*+,;=\:\@])*$/;BKUrlPath.$reSegmentNZ=/^(?:[A-Za-z0-9\-\._~]|%[A-Za-z0-9]{2}|[!$&'()*+,;=\:\@])+$/;BKUrlPath.$reSegmentNZNC=/^(?:[A-Za-z0-9\-\._~]|%[A-Za-z0-9]{2}|[!$&'()*+,;=\@])+$/;BKUrlPath.prototype.readAsString=function(v){if(v==null){this.clear();return true;}else{var str=v||"";if(this.isempty(str)){this.clear();return true;}var arr=String.reGroups2(str,BKUrlPath.$reParsePath,"abs","segment1","slash","segment");var parts=[];var abs=false;var hasfilepart=false;if(arr.hasmatches>0){var m;for(var i=0;i<arr.length;i++){m=arr[i];if(i==0){if(!this.isempty(m.abs)){abs=true;if(!this.isempty(m.segment1)){if(!BKUrlPath.$reSegmentNZ.test(m.segment1)){if(this.get_throwonerror()){throw"Incorrect syntax (characters) in the first segment of an non empty absolute URL";}return false;}parts.push(this.deCode(m.segment1));hasfilepart=true;}else{break;}}else{this.$abs=false;hasfilepart=false;if(!this.isempty(m.segment1)){var re=BKUrlPath.$reSegmentNZ;if(this.get_parent()!=null&&this.get_parent().get_scheme()!=null&&this.get_parent().get_scheme().get_isempty()){re=BKUrlPath.$reSegmentNZNC;}if(!re.test(m.segment1)){if(this.get_throwonerror()){throw"Incorrect syntax (characters) in the first segment of an non empty absolute URL";}return false;}parts.push(this.deCode(m.segment1));hasfilepart=true;}else{break;}}}else{if(this.isempty(m.segment)){hasfilepart=false;}else{if(BKUrlPath.$reSegment.test(m.segment)){parts.push(this.deCode(m.segment));hasfilepart=true;}else{if(this.get_throwonerror()){throw"Incorrect syntax (characters) in the "+i+" path segment";}return false;}}}}this.clear();this.$abs=abs;this.$hasfilepart=hasfilepart;this.$pathparts=parts;return true;}else{}}return false;};BKUrlPath.prototype.composeAsString=function(){var s="";if(this.$abs)s+="/";if(this.$pathparts.length>0){var p;for(var i=0;i<this.$pathparts.length;i++){p=this.enCode(this.$pathparts[i]);s+=p;if(i<this.$pathparts.length-1){s+="/";}}if(!this.get_hasfilepart()){s+="/";}}return s;};BKUrlPath.prototype.add=function(s,bterminate){if(this.isempty(s)){this.$hasfilepart=false;}else{if(this.$pathparts.length==0){if(this.$abs){if(!this.validateNotEncoded(BKUrlPath.$reSegmentNZ,s)){if(this.get_throwonerror()){throw"Inocrrect path segment";}return false;}}else{if(this.get_parent()&&this.get_parent().get_scheme()&&this.get_parent().get_scheme().get_isempty()){if(!this.validateNotEncoded(BKUrlPath.$reSegmentNZNC,s)){if(this.get_throwonerror()){throw"Inocrrect path segment";}return false;}}else{if(!this.validateNotEncoded(BKUrlPath.$reSegmentNZ,s)){if(this.get_throwonerror()){throw"Inocrrect path segment";}return false;}}}}else{if(!this.validateNotEncoded(BKUrlPath.$reSegment,s)){if(this.get_throwonerror()){throw"Inocrrect path segment";}return false;}}this.$pathparts.push(s+"");if(bterminate){this.$hasfilepart=false;}else{this.$hasfilepart=true;}}return true;};BKUrlPath.prototype.truncate=function(_n){var n;if(typeof _n=="number"){if(isNaN(_n))return false;n=_n;}else if(_n==null){n=0;}else{n=parseInt(_n+"");if(isNan(_n))return false;}if(n<=0){if(!this.$hasfilepart&&this.$pathparts.length>0){this.$hasfilepart=true;}else if(this.$abs&&this.$pathparts.length==0){this.$abs=false;}}else{if(n<=this.$pathparts.length){this.$pathparts.splice(n-1);}else{this.$pathparts=[];}if(this.$pathparts.length==0){this.hasfilepart=false;}}return true;};BKUrlPath.prototype.get_segment=function(idx){if(idx>=0&&idx<this.$pathparts.length){return this.$pathparts[idx];}};BKUrlPath.prototype.set_segment=function(idx,v){if(this.isempty(v)){return this.remove(idx);}if(idx>0&&idx<this.$pathparts.length){if(typeof v!="string")v=v+"";if(this.validateNotEncoded(BKUrlPath.$reSegment,v)){this.$pathparts[idx]=v;return true;}else{if(this.get_throwonerror()){throw"Inocrrect path segment";}return false;}}else if(idx==0&&this.$pathparts.length>0){if(typeof v!="string")v=v+"";if(this.$abs){if(!this.validateNotEncoded(BKUrlPath.$reSegmentNZ,v)){if(this.get_throwonerror()){throw"Inocrrect path segment";}return false;}}else{if(this.get_parent()&&this.get_parent().get_scheme()&&this.get_parent().get_scheme().get_isempty()){if(!this.validateNotEncoded(BKUrlPath.$reSegmentNZNC,v)){if(this.get_throwonerror()){throw"Inocrrect path segment";}return false;}}else{if(!this.validateNotEncoded(BKUrlPath.$reSegmentNZ,v)){if(this.get_throwonerror()){throw"Inocrrect path segment";}return false;}}}this.$pathparts[0]=v;return true;}};BKUrlPath.prototype.push=function(){throw"not implemented. Reserved for further version";};BKUrlPath.prototype.pull=function(){throw"not implemented. Reserved for further version";};BKUrlPath.prototype.remove=function(idx){if(idx>=0&&idx<this.$pathparts.length){if(idx==this.$pathparts.length-1){this.$hasfilepart=false;}this.$pathparts.splice(idx,1);return true;}else{return false;}};BKUrlPath.prototype.get_pathname=function(){var s="";if(this.$abs)s+="/";for(var i=0;i<this.$pathparts.length;i++){if(i==this.$pathparts.length-1){if(!this.$hasfilepart){s+=this.$pathparts[i]+"/";}}else{s+=this.$pathparts[i]+"/";}}return s;}.Description("Gets the current path only. Will leave out any file part. Not very useful on relative paths");BKUrlPath.prototype.get_filename=function(){if(this.$pathparts.length>0&&this.$hasfilepart){return this.$pathparts[this.$pathparts.length-1];}return null;};BKUrlPath.ImplementProperty("pathmap",new InitializeObject("Map object - names to indices"));BKUrlPath.prototype.mapGet=function(path){};BKUrlPath.prototype.mapSet=function(path,v){};BKUrlPath.prototype.$mapnode=function(_patharray){if(_patharray==null)return null;var patharray=_patharray;if(typeof _patharray=="string"){patharray=_patharray.split(/\./);}if(!BaseObject.is(patharray,"Array")){return null;}if(typeof this.get_pathmap()=="object"){var o=this.get_pathmap();for(var i=0;i<patharray.length;i++){if(typeof o=="object"){o=o[patharray];continue;}else{return null;}}}else{return null;}};