function FormatterBase(){}FormatterBase.Inherit(BaseObject,"FormatterBase");FormatterBase.getFormatterParameter=function(args,defVal){if(args!=null&&args.length>=3&&args[2]!=null){return args[2];}return defVal;};FormatterBase.getParameter=function(args,defVal){if(args!=null&&args.length>=3&&args[2]!=null){return args[2];}else if(args!=null&&args.length>=2&&BaseObject.is(args[1],"CBinding")){var r=args[1].bindingParameter;if(r!=null)return r;}return defVal;};FormatterBase.callFormatter=function(customObject,fmtName,direction,val,bind,args){var fmt=null;var m=direction=="source"?"FromTarget":"ToTarget";if(customObject!=null){if(typeof customObject[fmtName]=="object"){if(typeof customObject[fmtName][m]!="function")throw"Method "+m+" not found on custom formatter "+fmtName+" in class "+CObject.fullTypeOf(customObject);fmt=new CDelegate(customObject,customObject[fmtName][m]);}else{throw"Custom formatter "+fmtName+" cannot be found on "+CObject.fullTypeOf(customObject);}}else{fmt=Function.classes[fmtName];if(fmt!=null){if(typeof fmt[m]!="function")throw"Method "+m+" not found on system formatter "+fmtName;fmt=new CDelegate(fmt,m);}else{throw"Class not found when trying to find system formatter "+fmtName;}}if(fmt!=null){return fmt.invoke(val,bind,args);}};function SysFmtFilterObject(){}SysFmtFilterObject.Inherit(FormatterBase,"SysFmtFilterObject");SysFmtFilterObject.ToTarget=function(v,b,args){var arg=FormatterBase.getFormatterParameter(arguments,null);if(arg!=null&&arg.length>0){var arr=arg.split(" ");if(arr.length>0){var i,o,k,re;o={};re=[];for(i=1;i<arr.length;i++){re[i-1]=new RegExp(arr[i],"g");}if(arr[0].indexOf("include")==0){for(k in v){for(i=0;i<re.length;i++){if(re[i].test(k)){o[k]=v[k];break;}}}return o;}else if(arr[0].indexOf("exclude")==0){var pass=false;for(k in v){pass=false;for(i=0;i<re.length;i++){if(re[i].test(k)){pass=true;break;}}if(!pass){o[k]=v[k];}}return o;}else{throw new Error('Invalid parameter passed to SysFmtFilterObject.ToTarget formatter! First parameter must to be "include" or "exclude"');}}}return v;};SysFmtFilterObject.FromTarget=function(v,b,args){return v;};function SysFmtDateTime(){}SysFmtDateTime.Inherit(FormatterBase,'SysFmtDateTime');SysFmtDateTime.reTimeStamp=/\/Date\(([+-]?\d+)\)\//i;SysFmtDateTime.ToTarget=function(v,b,args){var date,pattern;args=SysFmtDateTime.ParseArgumentString(args);if(args.predefinedPattern){switch(args.predefinedPattern){case'd':pattern=Globalize.Default.culture(args.culture).calendar.patterns.d;break;case'D':pattern=Globalize.Default.culture(args.culture).calendar.patterns.D;break;case't':pattern=Globalize.Default.culture(args.culture).calendar.patterns.t;break;case'T':pattern=Globalize.Default.culture(args.culture).calendar.patterns.T;break;case'f':pattern=Globalize.Default.culture(args.culture).calendar.patterns.f;break;case'F':pattern=Globalize.Default.culture(args.culture).calendar.patterns.F;break;case'M':pattern=Globalize.Default.culture(args.culture).calendar.patterns.M;break;case'Y':pattern=Globalize.Default.culture(args.culture).calendar.patterns.Y;break;case'S':pattern=Globalize.Default.culture(args.culture).calendar.patterns.S;break;case'K':pattern=Globalize.Default.culture(args.culture).calendar.patterns.K;break;default:pattern=Globalize.Default.culture(args.culture).calendar.patterns.d;break;}}else if(args.explicitPattern){pattern=args.explicitPattern;}var matches=SysFmtDateTime.reTimeStamp.exec(v);if(matches!=null){var timeStampNumber=parseInt(matches[1],10);date=new Date(timeStampNumber);}var c=args.culture;date=Globalize.Default.format(date,pattern,args.culture);return date;};SysFmtDateTime.FromTarget=function(v,b,args){throw new Error('SysFmtDateTime.FromTarget not implemented exception!');};SysFmtDateTime.ParseArgumentString=function(arg,base){var re=/(?:(?:^|\s)([a-z]{2})(?:\-([A-Za-z]{2}))?(?=$|\s))|(?:(?:(?:^|\s)\')(?:([a-zA-Z]{1})|(\S{4,24}))(?=\'(?=$|\s)))|(?:(?:^|\s)(utc|local|default)(?=$|\s))/g;var a=arg;re.lastIndex=0;var m,i;var result={culture:null,subculture:null,predefinedPattern:null,explicitPattern:null,timePolicy:null};if(!arg){result={culture:'en',subculture:null,predefinedPattern:'d',explicitPattern:null,timePolicy:'local'};}if(base!=null){for(i in base){if(base[i]!=null)result[i]=base[i];}}while(m=re.exec(arg)){for(i=1;i<=5;i++){if(m[i]!=null&&m[i].length&&m[i].length>0){switch(i){case 1:result.culture=m[i];if(m[i+1]!=null&&m[i+1].length>0)result.subculture=m[i+1];break;case 3:result.predefinedPattern=m[i];break;case 4:result.explicitPattern=m[i];break;case 5:result.timePolicy=m[i];break;}}}}return result;};function SysFmtToBoolean(){}SysFmtToBoolean.Inherit(FormatterBase,'SysFmtToBoolean');SysFmtToBoolean.ToTarget=function(v,b,args){var arg=FormatterBase.getFormatterParameter(arguments,"");var result=SysFmtToBoolean.GetResult(v);if(arg=='inverse'){return!result;}return result;};SysFmtToBoolean.FromTarget=function(value,binding,args){var arg=FormatterBase.getFormatterParameter(arguments,"");var result=SysFmtToBoolean.GetResult(value);if(arg=='inverse'){return!result;}return result;};SysFmtToBoolean.GetResult=function(v){var regEx=/true|yes|yea|yep|on|да|si|ja/gi;if(v==null)return false;if(v==true)return true;if(typeof v=='number'){if(v>0)return true;else{return false;}}else if(typeof v=='string'){if(v.length==0)return false;if(isNaN(parseInt(v))){if(regEx.test(v)){return true;}else{return false;}}else{if(parseInt(v)>0)return true;else{return false;}}}else{return false;}};function SysFmtIsNull(){}SysFmtIsNull.Inherit(FormatterBase,"SysFmtIsNull");SysFmtIsNull.ToTarget=function(v,b,args){var arg=FormatterBase.getFormatterParameter(arguments,"isnull");if(arg!=null&&arg.length>0){arg=arg.trim();if(arg=="notnull"||arg=="not"){if(v!=null)return true;}else if(arg==='is'||arg==='isnull'){if(v==null)return true;}else{throw new Error('You entered wrong parameter. Check for null value against "notnull", "not", "isnull" or "is" parameter word');}}return false;};SysFmtIsNull.FromTarget=function(v,b,args){throw new Error("SysFmtIsNull MUST not be used in FromTarget direction.");};function SysFmtNullOrEmptyToString(){}SysFmtNullOrEmptyToString.Inherit(FormatterBase,'SysFmtNullOrEmptyToString');SysFmtNullOrEmptyToString.ToTarget=function(value,binding,args){if(value===null){return'';}else if(value===''||typeof value==='undefined'){return null;}else{throw new Error("Null or Empty string must be passed as value to the SysFmtNullOrEmptyToString.ToTarget");}};SysFmtNullOrEmptyToString.FromTarget=function(value,binding,args){if(value===null){return'';}else if(value===''||typeof value==='undefined'){return null;}else{throw new Error("Null or Empty string must be passed as value to the SysFmtNullOrEmptyToString.FromTarget");}};function SysFmtCurrency(){}SysFmtCurrency.Inherit(FormatterBase,'SysFmtCurrency');SysFmtCurrency.ToTarget=function(v,b,args){args=SysFmtCurrency.ParseArguments(args);if(!v)throw new Error('Null or undefined value passed to the formatter');if(typeof v=='string')v=parseFloat(v);if(isNaN(v)){throw new Error('Valid number must be passed as value to the formatter!');}var formattedValue=Globalize.format(v,'c',args.culture);return formattedValue;};SysFmtCurrency.FromTarget=function(v,b,args){args=SysFmtCurrency.ParseArguments(args);var radix=10;var a=Globalize.parseFloat(v,radix,args.culture);if(isNaN(a)){throw new Error('Valid number must be passed as value to the formatter!');}return a;};SysFmtCurrency.ParseArguments=function(parameters){var args={culture:null,formatPattern:null,timeSystem:null};if(!parameters){args.culture='en';return args;}var firstSpaceIndex,firstQuotationIndex,secondQuotationIndex,secondSpaceIndex,firstParam,secondParam,thirdParam;parameters=parameters.trim();firstSpaceIndex=parameters.indexOf(' ');if(firstSpaceIndex==-1){args.culture=parameters;}else{firstParam=parameters.substr(0,2);if(SysFmtCurrency.ValidateParam(firstParam))args.culture=firstParam;firstQuotationIndex=parameters.indexOf('\'',firstSpaceIndex);secondQuotationIndex=parameters.indexOf('\'',firstQuotationIndex+1);secondSpaceIndex=parameters.indexOf(' ',secondQuotationIndex+1);if(firstQuotationIndex>0){if(secondQuotationIndex>0){secondParam=parameters.substring(firstQuotationIndex+1,secondQuotationIndex).trim();if(SysFmtCurrency.ValidateParam(secondParam))args.formatPattern=secondParam;}else{throw'Second formatter parameter has to be bound in single quotation marks: \'parameter\'';}}else{return parameters;}if(secondSpaceIndex>0){thirdParam=parameters.substr(secondSpaceIndex+1,parameters.length).trim();if(SysFmtCurrency.ValidateParam(thirdParam))args.timeSystem=thirdParam;}else{return args;}return args;}return args;};SysFmtCurrency.ValidateParam=function(str){if(!(str.charCodeAt(0)>96&&str.charCodeAt(str.length-1)<123)){throw'Invalid parameter format!';}return true;};function SysFmtRoundDecimal(){}SysFmtRoundDecimal.Inherit(FormatterBase,'SysFmtRoundDecimal');SysFmtRoundDecimal.ToTarget=function(v,b,args){var numberOfDigitsAfterComma=FormatterBase.getFormatterParameter(arguments,'2');v=parseFloat(v);if(isNaN(v)){throw new Error('Insert valid number to the SysFmtRoundDecimal formatter');}numberOfDigitsAfterComma=parseInt(numberOfDigitsAfterComma,10);if(isNaN(numberOfDigitsAfterComma)){numberOfDigitsAfterComma=2;}if(numberOfDigitsAfterComma<21){var module=Math.pow(10,numberOfDigitsAfterComma);v=parseFloat((Math.round(v*module)/module).toFixed(numberOfDigitsAfterComma));}return v;};SysFmtRoundDecimal.FromTarget=function(v,b,args){var numberOfDigitsAfterComma=FormatterBase.getFormatterParameter(arguments,'2');v=parseFloat(v);if(isNaN(v)){throw new Error('Insert valid number to the SysFmtRoundDecimal formatter');}numberOfDigitsAfterComma=parseInt(numberOfDigitsAfterComma,10);if(isNaN(numberOfDigitsAfterComma)){numberOfDigitsAfterComma=2;}if(numberOfDigitsAfterComma<21){var module=Math.pow(10,numberOfDigitsAfterComma);v=parseFloat((Math.round(v*module)/module).toFixed(numberOfDigitsAfterComma));}return v;};function SysFmtArrayOrObjectAsString(){}SysFmtArrayOrObjectAsString.Inherit(FormatterBase,'SysFmtArrayOrObjectAsString');SysFmtArrayOrObjectAsString.ToTarget=function(v,b,args){var result={'r':''},i,len,delimiter=FormatterBase.getFormatterParameter(arguments,',');if(!({}.toString.apply(v)=='[object Array]'||{}.toString.apply(v)=='[object Object]')){throw new Error("Not an array or object has been passed to the SysFmtArrayOrObjectAsString formatter!");}SysFmtArrayOrObjectAsString.parseObjectRecursive(v,delimiter,result);result.r=result.r.substr(0,result.r.length-1);return result.r;};SysFmtArrayOrObjectAsString.parseObjectRecursive=function(obj,delimiter,result){if({}.toString.apply(obj)=='[object Array]'){var len=obj.length;for(var i=0;i<len;i++){var currentElement=obj[i];if(currentElement instanceof Array){SysFmtArrayOrObjectAsString.parseObjectRecursive(currentElement,delimiter,result);}else if({}.toString.apply(currentElement)=='[object Object]'){for(var key in currentElement){if({}.toString.apply(currentElement[key])=='[object Object]'||{}.toString.apply(currentElement[key])=='[object Array]'){SysFmtArrayOrObjectAsString.parseObjectRecursive(currentElement[key],delimiter,result);}else{result.r+=currentElement[key]+delimiter;}}}else{result.r+=currentElement+delimiter;}}}else if({}.toString.apply(obj)=='[object Object]'){for(var key in obj){if({}.toString.apply(obj[key])=='[object Object]'||{}.toString.apply(obj[key])=='[object Array]'){SysFmtArrayOrObjectAsString.parseObjectRecursive(obj[key],delimiter,result);}else{result.r+=obj[key]+delimiter;}}}else{result.r+=obj[key]+delimiter;}};SysFmtArrayOrObjectAsString.FromTarget=function(v,b,args){throw new Error("SysFmtArrayOrObjectAsString MUST not be used in FromTarget direction.");};function SysFmtStringInSet(){}SysFmtStringInSet.Inherit(FormatterBase,"SysFmtStringInSet");SysFmtStringInSet.$reSyntax=/^([a-z]*):(.*)$/i;SysFmtStringInSet.ToTarget=function(v,binding,args){var i,arr,current,param=FormatterBase.getFormatterParameter(arguments,'');if(!({}.toString.apply(v)=='[object String]'||{}.toString.apply(v)=='[object Array]'||{}.toString.apply(v)=='[object Object]')){throw new Error("Not an array, object or string has been passed to the SysFmtArrayOrObjectAsString formatter!");}arr=SysFmtStringInSet.$reSyntax.exec(param);if(arr!=null){var cmd=arr[1];var words=arr[2].split(";");if(words!=null&&words.length){var wordsBool={};for(i=0;i<words.length;wordsBool[words[i++]]=true);switch(cmd){case"or":if(BaseObject.is(v,"Array")){for(i=0;i<v.length;i++){if(typeof v[i]=='string'){current=wordsBool[v[i].toLowerCase()];if(current!==undefined){if(current===true)return true;}}}}else if({}.toString.apply(v)=="[object Object]"){for(i in v){if(wordsBool[i.toLowerCase()]===true)return true;}}else if(typeof v=="string"){for(i=0;i<words.length;i++){if(v.toLowerCase().indexOf(words[i])>=0||words[i]==="")return true;}}break;case"all":case"and":if(BaseObject.is(v,"Array")){var isTrue=false;for(var key in wordsBool){isTrue=false;for(i=0;i<v.length;i++){var curr=v[i].toString().toLowerCase();if(curr===key||curr===wordsBool[key]){isTrue=true;break;}}if(!isTrue){return false;}}return isTrue;}else if({}.toString.apply(v)=="[object Object]"){for(i in v){if(wordsBool[i.toLowerCase()]!==true)return false;}}else if(typeof v=="string"){for(i=0;i<words.length;i++){if(v.toLowerCase().indexOf(words[i])<0||words[i]==="")return false;}}return true;}}return false;}else{throw new Error('Invalid expression in the formatter parameter. The right format is: (<condition>:<word1;word2;word3...>). Note that the delimiter is ";". Condition must be "and", "or", "all"');}};SysFmtStringInSet.FromTarget=function(v,binding){throw new Error("SysFmtStringInSet cannot be used with bidirectional bindings!");};function SysFmtChangeCase(){}SysFmtChangeCase.Inherit(FormatterBase,"SysFmtChangeCase");SysFmtChangeCase.ToTarget=function(value,binding,args){var result,condition=FormatterBase.getFormatterParameter(arguments,'toUpper');if(typeof value!=='string'){throw new Error('Only strings are allowed to be formatted by SysFmtChangeCase');}if(condition==='toUpper'){result=value.toUpperCase();}else if(condition==='toLower'){result=value.toLowerCase();}else{throw new Error('Only "toUpper" and "toLower" parameters are allowed in SysFmtChangeCase');}return result;};SysFmtChangeCase.FromTarget=SysFmtChangeCase.ToTarget;function SysFmtNumberDisplacement(){}SysFmtNumberDisplacement.Inherit(FormatterBase,'SysFmtNumberDisplacement');SysFmtNumberDisplacement.ToTarget=function(value,binding,args){var number,param=FormatterBase.getFormatterParameter(arguments,1);if(typeof value==='number'){number=value;}else if(typeof value==='string'){number=parseInt(value);if(isNaN(number)){throw new Error('Please, enter valid number as value to the SysFmtNumberDisplacement');}}else{throw new Error('Please, enter valid number as value to the SysFmtNumberDisplacement');}if(typeof param==='string'){param=parseInt(param);if(isNaN(param)){throw new Error('Please, enter valid number as parameter to the SysFmtNumberDisplacement');}}if(typeof param==='number'){number+=param;}else{throw new Error('Please, enter valid number as parameter to the SysFmtNumberDisplacement');}return number;};SysFmtNumberDisplacement.FromTarget=SysFmtNumberDisplacement.ToTarget;function SysFmtStringToArray(){}SysFmtStringToArray.Inherit(FormatterBase,'SysFmtStringToArray');SysFmtStringToArray.ToTarget=function(value,binding,args){var result=[],param=FormatterBase.getFormatterParameter(arguments,',');if(BaseObject.is(value,"Array"))return value;if(typeof value!=='string'){throw new Error('Value passed to the SysFmtStringToArray must to be string or array');}result=SysFmtStringToArray.splitAndRemoveEmptyEntries(value,param);return result;};SysFmtStringToArray.FromTarget=SysFmtStringToArray.ToTarget;SysFmtStringToArray.splitAndRemoveEmptyEntries=function(str,param){var result=[],i=0,len,temp=str.split(param),trimStr;len=temp.length;for(;i<len;i+=1){trimStr=temp[i].trim();if(temp[i].length!==0){result.push(trimStr);}}return result;};