function CommandReg(owner){BaseObject.apply(this,arguments);this.owner=owner;}CommandReg.Inherit(BaseObject,"CommandReg");CommandReg.prototype.$commands=new InitializeArray("Commands register");CommandReg.prototype.$regexps=new InitializeArray("Array of the commands that have regexps ");CommandReg.prototype.ownerString=function(){if(typeof this.owner=="string")return this.owner;if(BaseObject.is(owner,"BaseObject"))return owner.fullClassType();return"(owner not determined)";};CommandReg.prototype.exists=function(cmd_or_name){if(this.get(cmd_or_name)!=null)return true;return false;};CommandReg.prototype.get=function(cmdname){if(typeof cmdname=="string"){return this.$commands.FirstOrDefault(function(idx,item){if(item.get_name()==cmdname||item.get_alias()==cmdname)return item;return null;});}else if(BaseObject.is(cmdname,"CommandDescriptor")){var cmd=cmdname;return this.$commands.FirstOrDefault(function(idx,item){if(item.get_name()==cmd.get_name()||item.get_name()==cmd.get_alias()||item.get_alias()!=null&&item.get_alias()==cmd.get_name()||item.get_alias()!=null&&item.get_alias()==cmd.get_alias())return item;return null;});}else{return null;}};CommandReg.prototype.find=function(token,meta){var cmd=null;var subtype=BaseObject.getProperty(meta,"subtype",null);if(typeof token=="string"&&subtype=="identifier"){if(this.$regexps!=null){cmd=this.$regexps.FirstOrDefault(function(idx,item){var r=item.get_regexp();if(r!=null){if(r.test(token))return item;}return null;});if(cmd!=null){return cmd;}}cmd=this.get(token);if(cmd!=null&&cmd.get_action()!=null){return cmd;}return null;}return null;};CommandReg.prototype.$index=function(cmd){if(cmd.get_regexp()!=null){this.$regexps.addElement(cmd);}};CommandReg.prototype.register=function(command,alias,regexp,action,help,bOverwrite){var cmd;if(typeof command=="string"){cmd=new CommandDescriptor(command,alias,regexp,action,help);}else if(BaseObject.is(command,"CommandDescriptor")){cmd=command;}else if(typeof command=="object"){cmd=new CommandDescriptor(command.command,command.alias,command.regexp,command.action,command.help);}else{throw"Unusable arguments - check documentation";}var existing=this.get(cmd);if(existing!=null&&!bOverwrite)throw"Command with the same name or alias already exists - name:"+existing.get_name()+" alias:"+(existing.get_alias()||"(no alias)")+"in command register with an owner "+this.ownerString();if(existing!=null){this.$commands.removeElement(existing);this.$regexps.removeElement(existing);}this.$commands.addElement(cmd);this.$index(cmd);};CommandReg.prototype.unregister=function(command){var existing=this.get(command);if(existing!=null){this.$commands.removeElement(existing);this.$regexps.removeElement(existing);return true;}return false;};CommandReg.$Global=null;CommandReg.Global=function(){if(this.$Global==null){this.$Global=new CommandReg("$SYSTEM");}return this.$Global;};