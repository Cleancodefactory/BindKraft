Binding.updateEntityState=true;Binding.entityStatePropertyName="state";Binding.entityStateValues=DataStateEnum;var STUFFRESULT={VIEWS:0x0001,RESOURCES:0x0002,LOOKUPS:0x0004,RULES:0x0008,SCRIPTS:0x0010,DATA:0x0020,METADATA:0x0040,RVIEWS:0x0080,ALL:0xFFFF};var PACKETSTUFFING_BRANCHESANDFLAGS={views:STUFFRESULT.VIEWS,resources:STUFFRESULT.RESOURCES,lookups:STUFFRESULT.LOOKUPS,rules:STUFFRESULT.RULES,scripts:STUFFRESULT.SCRIPTS,metadata:STUFFRESULT.METADATA,rviews:STUFFRESULT.RVIEWS};var PACKETSTUFFING_BRANCH_HANDLERS={rviews:{},views:{},resources:{onApplyToInstance:function(item,hash){if(item==null)return;this._resources=item.data;}},lookups:{onApplyToInstance:function(item,hash){if(this.is("ViewBase")){this.lookups=item.data;}}},rules:{onCacheItem:function(){var currentId=0;function _getnextId(prefix){return prefix+currentId++;}return function(oldItem,newItem,hash){if(oldItem!=null&&oldItem.domId!=null){Function._rules[oldItem.domId]=null;$("#"+oldItem.domId).remove();}if(newItem!=null){if(Function._rules==null)Function._rules={};newItem.domId=_getnextId("rule");var script='<script type="text/javascript" id="'+newItem.domId+'">'+' Function._rules["'+newItem.domId+'"] = '+newItem.data+';'+'</script>';$('body').append(script);}};}(),onApplyToInstance:function(item,hash){if(item!=null&&item.domId!=null&&this.is("IRuleSource")){this._rules=Function._rules[item.domId];}}},scripts:{onCacheItem:function(){var currentId=0;function _getnextId(prefix){return prefix+currentId++;}return function(oldItem,newItem,hash){var n;if(oldItem!=null&&oldItem.halfDomId!=null){for(n in oldItem){$("#"+oldItem.halfDomId+n).remove();}}if(newItem!=null&&newItem.data!=null){newItem.halfDomId=_getnextId("script");for(n in newItem.data){if(newItem.data[n]!=null&&newItem.data[n].length>0){var script='<script type="text/javascript" id="'+newItem.halfDomId+n+'">'+newItem.data[n]+';'+'</script>';$('body').append(script);}}}};}()},metadata:{onApplyToInstance:function(item,hash){if(item!=null&&this.is("ViewBase")){this.metadata=item.data;}}}};System.prototype.loadSystemSettings=function(){this.settings={};};GenericViewBaseEx.prototype.serverStoreData=function(data,pathIn,callback,callbackFailure,sync,failonoperations){if(this.metadata!=null&&typeof this.metadata=="object"){if(this.metadata.execinfo!=null){var execinfo=this.metadata.execinfo;if(typeof execinfo=="object"){if(execinfo.executor!=null&&execinfo.packageid!=null){var url;if(execinfo.opmode=="private"){url=execinfo.executor+"?$pwrite="+execinfo.packageid;}else{url=execinfo.executor+"?$write="+execinfo.packageid;}var path=null;if(pathIn!=null){if(typeof pathIn=="string"){path=pathIn;}else if(typeof pathIn=="object"){path=pathIn.path;}}if(path!=null){url+="/"+path;}else{if(execinfo.nodepath!=null){url+="/"+execinfo.nodepath;}}}else{alert("serverStoreData cannot determine packageId or/and executor");return;}var getparams=null;if(pathIn!=null&&typeof pathIn=="object"){getparams=pathIn.params;}var d;if(data==null){d=this.get_data();}else{d=data;}this.ajax({url:url,type:"POST",dataType:'xml',contentType:"application/json; charset=utf-8",data:d,cache:false,getparams:getparams,success:function(result){if(result.status.issuccessful&&callback!=null){callback.call(this,result.data,path);}else{if(callbackFailure!=null){if(callbackFailure.call(this,result.status,path)===false){}else{Messenger.Default.post(new WorkspaceNotificationMessage("AJAX Error","AJAX Error","Operation failure reported: "+result.status.message,true));}}else{Messenger.Default.post(new WorkspaceNotificationMessage("AJAX Error","AJAX Error","Operation failure reported: "+result.status.message,true));}}},async:!sync},"xml");}else{alert("serverStoreData cannot find any execinfo in the metadata");}}else{alert("serverStoreData cannot find metadata");}}else{alert("serverStoreData cannot find metadata. The metadata is usually loaded together with the data context returned by the server when the view opens. If you do not follow the appropriate pattern you cannot use serverStoreData and you should use ajaxPostXml directly.");}};function jb_initFramework(globalProvider){var gp=globalProvider;Function._rules={};CacheManager.Default=new CacheManager(PACKETSTUFFING_BRANCHESANDFLAGS,PACKETSTUFFING_BRANCH_HANDLERS);if(System.Default().settings.DisableClientSideCaching){for(var i in CacheManager.Default.disableCacheBranches){CacheManager.Default.disableCacheBranches[i]=true;}}function corehelper_addParameter(url,name,val){if(val==null){return url;}if(url!=null){if(url.indexOf("?")>=0){url=url+"&"+name+"="+val;}else{url=url+"?"+name+"="+val;}}return url;};function corehelper_escapeParamString(val){if(val!=null){return"'"+encodeURIComponent(val)+"'";}else{return"";}};function ajaxContextParameter(obj,param){var p=null;if(BaseObject.is(obj,"IAjaxContextParameters")){return obj.get_ajaxcontextparameter(param);}if(gp!=null&&BaseObject.is(gp,"IAjaxContextParameters")){return gp.get_ajaxcontextparameter(param);}return null;}BaseObject.ajaxDecorateUrl=function(obj,url){var onBehalfUserIdName="sysonbehalfuser";var currentItemName="syscurrentitem";url=corehelper_addParameter(url,onBehalfUserIdName,ajaxContextParameter(obj,AjaxContextParameterFlags.OnBehalfUserId));url=corehelper_addParameter(url,currentItemName,ajaxContextParameter(obj,AjaxContextParameterFlags.CurrentItemId));return url;};var urlCleanUpExpression=/^(?:[a-z][a-z0-9\+\-\.]*\:\/\/\S*?(?:\/|\?))?(\S*)$/i;BaseObject.ajaxCleanURLForHashOperations=function(url){var cleanedUrl=urlCleanUpExpression.exec(url);if(cleanedUrl!=null){return cleanedUrl[1];}return url;};function core_ajaxAddRequestParameters(settings,obj){if(obj==null)return;for(var k in obj){switch(typeof obj[k]){case"no_string":settings.url=corehelper_addParameter(settings.url,k,corehelper_escapeParamString(obj[k]));break;case"no_number":settings.url=corehelper_addParameter(settings.url,k,isNaN(obj[k])?"0":obj[k].toString());break;default:var v=obj[k];if(v!=null){settings.url=corehelper_addParameter(settings.url,k,obj[k].toString());}else{settings.url=corehelper_addParameter(settings.url,k,null);}break;}}}function core_ajaxTotalProblems(settings){var problems=settings.confData.problems;var n=0;for(var k in problems){n+=BaseObject.getProperty(problems,k+".count",0);}return n;}function core_ajaxProblemResolver(ownerObject,settings,problemKey,logMessage,problemData){var maxTotalProblems=3;var maxSpecificProblem=2;var useRetry=["zerostatus","apperror"];var problems=settings.confData.problems;var problem=problems[problemKey];if(typeof problem=="object"){var ask=false;if(core_ajaxTotalProblems(settings)>maxTotalProblems)ask=true;if(problem.count!=null&&problem.count>maxSpecificProblem)ask=true;if(useRetry.findElement(problemKey)>=0){settings.RequestRpeatCount=BaseObject.getProperty(settings,"RequestRpeatCount",0)+1;if(ask){if(!confirm("Critical network or server side error has occured. The request has been retried, click OK to retry the request again or Cancel to stop trying.")){settings.AbortAllProcessing=false;return false;}}var ar=new ControllableAsyncResult(EventPump.Default(),new Delegate(ownerObject,function(){$.ajax(settings);}));ar.ownerObject=ownerObject;ar.apply();jbTrace.log(problemKey+" retry is scheduled, this is attempt "+problem.count+" of total "+core_ajaxTotalProblems(settings));settings.AbortAllProcessing=true;return true;}}return false;}function core_ajaxUnreportProblem(ownerObject,settings,problemKey){var problems=settings.confData.problems;if(problems[problemKey]!=null){delete problems[problemKey];}}function core_ajaxReportProblem(ownerObject,settings,problemKey,logMessage,problemData){var problems=settings.confData.problems;if(problems[problemKey]!=null){var problem=problems[problemKey];if(problem.count!=null){problem.count++;}else{problem.count=1;}problem.data=problemData;if(!BaseObject.is(problem.log,"Array"))problem.log=[];problem.log.push(logMessage);}else{problems[problemKey]={count:1,log:[logMessage],data:problemData};}return core_ajaxProblemResolver(ownerObject,settings,problemKey,logMessage,problemData);}function core_ajaxOnStartOperation(settings){ShowProgressBeforeAjax();jbTrace.log("AJAX START: "+settings.url,0xFF8002);settings.confData={problems:{}};var RequestContentFlags="sysrequestcontent";settings.url=BaseObject.ajaxDecorateUrl(this,settings.url);var stuffFlags=STUFFRESULT.DATA;if(this.is("IAjaxQueryRequestContent")){stuffFlags=this.getRequestContentFlags(settings);}stuffFlags=stuffFlags==null?0:stuffFlags;var cachableFlags=CacheManager.Default.get_cachableflags();var overrideFlags=settings.requestedContentFlags||0;stuffFlags=stuffFlags&(cachableFlags^stuffFlags|CacheManager.Default.onBeginRequest(settings));stuffFlags|=overrideFlags;settings.requestedContentFlags=stuffFlags;if(stuffFlags!=null){settings.url=corehelper_addParameter(settings.url,RequestContentFlags,stuffFlags.toString(16));}if(this.is("IAjaxQueryStringParams")){var params=this.get_queryParameters();if(params!=null){for(var i in params){if(BaseObject.is(params[i],"Array")){for(var j=0;j<params[i].length;j++){settings.url=corehelper_addParameter(settings.url,i,params[i][j]);}}else{settings.url=corehelper_addParameter(settings.url,i,params[i]);}}}}if(settings.getparams!=null&&typeof settings.getparams=="object"){core_ajaxAddRequestParameters(settings,settings.getparams);}if(settings.type=="POST"){if(settings.data!=null&&typeof settings.data!="string"&&!settings.serializationDone){settings.data=JSON.stringify(settings.data);}else if(settings.data==null){settings.data="{}";}}else{if(stuffFlags&STUFFRESULT.ALL){if(settings.data!=null&&typeof settings.data!="string"){core_ajaxAddRequestParameters(settings,settings.data);settings.data=null;}}else{settings.immediateResult={status:{issuccessful:true,message:null,returnurl:null,httpSuccess:true,httpStatus:304,httpStatusText:"Not Modified",httpDescription:"Nothing is actually requested from the server. The request has been shortcircuited."}};return true;}}};function core_nextgenAjaxRedirect(result,status){if(result!=null&&result.status!=null&&!result.status.issuccessful){if(result.status.returnurl!=null&&result.status.returnurl.length>0){window.location=mapPath(result.status.returnurl);}}}function core_ajaxOnEndOperation(settings,result,status){HideProgressAfterAjax();settings.AbortAllProcessing=false;jbTrace.log("AJAX END: "+settings.url,0xFF8020);var o={status:{issuccessful:false,message:null,returnurl:null,httpSuccess:status.success,httpStatus:status.status,httpStatusText:status.statusText,httpDescription:status.description}};if(status.success){if(result!=null){var node,xml=$(result);node=xml.find("packet>status");if(node!=null&&node.length>0){var s=node.attr("issuccessful");s=s!=null?parseInt(s,10):0;s=!isNaN(s)&&s!=0?true:false;var r=node.attr("isreadonly");r=r!=null?parseInt(r,10):0;r=!isNaN(r)&&r!=0?true:false;var pr=node.attr("isprobing");pr=pr!=null?parseInt(pr,10):0;pr=!isNaN(pr)&&pr!=0?true:false;o.status={issuccessful:s,isreadonly:r,isprobing:pr,message:node.find("message").text(),returnurl:node.find("returnurl").text(),title:node.find("title").text()};node=node.find("messages");if(node!=null&&node.length>0){o.status.messages=jQuery.parseJSON(node.text());}node=xml.find("packet>status>operations");if(node!=null&&node.length>0){o.status.operations=jQuery.parseJSON(node.text());}}else{o.status={issuccessful:false,message:"Missing status section in the server response",returnurl:null};}if(o.status.returnurl!=null&&o.status.returnurl.length==0)o.status.returnurl=null;if(o.status.message!=null&&o.status.message.length==0)o.status.message=null;if(BaseObject.is(o.status.messages,"Array")){for(var i=0;i<o.status.messages.length;i++){var m=o.status.messages[i];InfoMessageQuery.emit(this,m);}}if(!o.status.issuccessful){if(o.status.isprobing&&(settings.RequestRpeatCount==null||settings.RequestRpeatCount<3)){jbTrace.log("received isprobing status - repeating request");settings.AbortAllProcessing=true;settings.RequestRpeatCount=1;$.ajax(settings);return o;}if(window.g_JDebug){InfoMessageQuery.emit(this,"Server operation unsuccessful: "+"HTTP status: "+(o.status.status||"")+"\nstatus text: "+(o.status.message||"...")+"\ndescription: "+(o.status.description||"...")+(settings.url!=null?"\nurl: "+settings.url:""),0x8002,"error");}else{InfoMessageQuery.emit(this,(o.status.title||"Error occurred!")+" "+o.status.message||"General error",0x8002,"error");}core_nextgenAjaxRedirect(o);return o;}else{if(settings.failonoperations!=null&&o.status.operations!=null){for(var op in settings.failonoperations){if(op!="skipErrorProcessing"&&settings.failonoperations[op]==o.status.operations[op]){settings.failRequest={statusText:"Conditional failure",description:"The operation "+op+" failed while processing the request",skipErrorProcessing:settings.failonoperations.skipErrorProcessing};break;}}}}node=xml.find("packet>views");var c;if(node!=null&&node.length>0){c=node.children();if(c.length>0){o.views={};for(var i=0;i<c.length;i++){o.views[c[i].tagName]=$(c[i]).text().trim();}}}node=xml.find("packet>rviews");if(node!=null&&node.length>0){var c=node.children();if(c.length>0){o.rviews={};for(var i=0;i<c.length;i++){o.rviews[c[i].tagName]=$(c[i]).text().trim();}}}node=xml.find("packet>data");if(node!=null&&node.length>0){o.data=jQuery.parseJSON(node.text());}node=xml.find("packet>metadata");if(node!=null&&node.length>0){o.metadata=jQuery.parseJSON(node.text());}node=xml.find("packet>rules");if(node!=null&&node.length>0){o.rules=node.text();}node=xml.find("packet>resources");if(node!=null&&node.length>0){o.resources=jQuery.parseJSON(node.text());}node=xml.find("packet>lookups");if(node!=null&&node.length>0){o.lookups=jQuery.parseJSON(node.text());}node=xml.find("packet>scripts");if(node!=null&&node.length>0){c=node.children();if(c!=null&&c.length>0){o.scripts={};for(var i=0;i<c.length;i++){o.scripts[c[i].tagName]=$(c[i]).text().trim();}}else{o.scripts=node.text().trim();}}}else{o.status.issuccessful=o.status.httpSuccess?true:false;}CacheManager.Default.onEndRequest(settings,o);}else{o.status.issuccessful=false;if(o.status.httpStatus==500){if(core_ajaxReportProblem(this,settings,"apperror","Application error (500)",null)){if(status.xhr!=null){jbTrace.log("AJAX ERROR: HTTP status: "+status.xhr.status+"\nstatus text: "+o.status.httpStatusText+"\ndescription: "+o.status.httpDescription+(settings.url!=null?"\nurl: "+settings.url:"")+"\n------\n"+status.xhr.responseText);}else{jbTrace.log("Application error - 500");}return o;}}else if(o.status.httpStatus==401){window.location.href=mapPath('/account/signin')+'?returnUrl=/';settings.AbortAllProcessing=true;}}if(o!=null&&o.status!=null&&!o.status.issuccessful&&o.status.httpStatus==0){if(core_ajaxReportProblem(this,settings,"zerostatus","Request returned incorrect status 0",null)){jbTrace.log("received status - 0");return o;}}core_nextgenAjaxRedirect(o);return o;};function core_nextgenAjaxErrorHandler(xmlHttpReq,textStatus,errDescription,setttings){if(BaseObject.is(this,"IStructuralQueryEmiter")){this.throwStructuralQuery(new InfoMessageQuery("AJAX Error: "+"HTTP status: "+xmlHttpReq.status+"\nstatus text: "+textStatus+"\ndescription: "+errDescription+(setttings.url!=null?"\nurl: "+setttings.url:""),0x8001,"error"));}else{Messenger.Default.post(new WorkspaceNotificationMessage("AJAX Error","AJAX Error","HTTP status: "+xmlHttpReq.status+"\nstatus text: "+textStatus+"\ndescription: "+errDescription+(setttings.url!=null?"\nurl: "+setttings.url:"")+"\n------\n"+xmlHttpReq.responseText,true));}jbTrace.log("AJAX ERROR: HTTP status: "+xmlHttpReq.status+"\nstatus text: "+textStatus+"\ndescription: "+errDescription+(setttings.url!=null?"\nurl: "+setttings.url:"")+"\n------\n"+xmlHttpReq.responseText);ReportError("HTTP status: "+xmlHttpReq.status+";status text: "+textStatus+";description: "+errDescription+(setttings.url!=null?"\nurl: "+setttings.url:"")+";"+xmlHttpReq.responseText,xmlHttpReq.statusText,"");var loc;if(xmlHttpReq.status==302){var loc=xmlHttpReq.getResponseHeader("Location");window.location.href=loc;}};BaseObject.ajaxDefaults={xml:{cache:false,error:core_nextgenAjaxErrorHandler,onStartOperation:core_ajaxOnStartOperation,onEndOperation:core_ajaxOnEndOperation,mapUrl:true}};};function InitCulture(){if(!System.Default().settings.CurrentLang){System.Default().settings.CurrentLang='en';}var g_UTCDate=false;Globalize.Default=new Globalize(System.Default().settings.CurrentLang,g_UTCDate);Globalize.UTCMode=new Globalize(System.Default().settings.CurrentLang,true);Globalize.LocalMode=new Globalize(System.Default().settings.CurrentLang,false);}