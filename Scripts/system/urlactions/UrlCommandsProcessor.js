function UrlCommandsProcessor(){BaseObject.apply(this,arguments);this.scriptsdir=System.FS("appfs").cd("system/urlcommands/scripts");this.aliasdir=System.FS("appfs").cd("system/urlcommands/aliases");this.general=System.FS("appfs").cd("system/urlcommands").item("general");if(!BaseObject.is(this.general,"PropertySetMemoryFile")){this.general=null;}}UrlCommandsProcessor.Inherit(BaseObject,"UrlCommandsProcessor");UrlCommandsProcessor.StatementDelimiter=" ";UrlCommandsProcessor.prototype.getAlias=function(alias){var a=this.aliasdir.item(alias);if(BaseObject.is(a,"PropertySetMemoryFile")){return a;}return null;};UrlCommandsProcessor.prototype.getScript=function(name){var scr=this.scriptsdir.item(name);if(BaseObject.is(scr,"CLScript")){return scr.get_script();}return null;};UrlCommandsProcessor.prototype.resolveAliasToScript=function(alias){var a=this.getAlias(alias);var result=null;if(a!=null){result="";var deps=a.getProp("dependencies");if(typeof deps=="string")deps=[deps];if(BaseObject.is(deps,"Array")){for(var i=0;i<deps.length;i++){var d=deps[i];var s;if(typeof d=="string"){if(d.indexOf("script:")==0){s=this.getScript(d.slice("script:".length));if(s==null)continue;if(result.length>0)result+=UrlCommandsProcessor.StatementDelimiter;result+=s;}else if(d.indexOf("cl:")==0){s=d.slice("cl:".length);if(result.length>0)result+=UrlCommandsProcessor.StatementDelimiter;result+=s;}}}}return result;}};UrlCommandsProcessor.prototype.getURLCommands=function(url){var qry=null;if(!BaseObject.is(url,"IBKUrlObject"))return null;if(url.is("BKUrl")){if(BaseObject.is(url.get_query(),"BKUrlQuery")){qry=url.get_query();}}else if(url.is("BKUrlQuery")){qry=url;}if(qry==null)return null;if(this.general==null)return null;var pref=this.general.getProp("prefix");if(typeof pref!="string"||pref.length==0)return null;var keys=qry.keys(PatternChecker.StartsWith(pref));if(keys.length>0){var cmds={};for(var i=0;i<keys.length;i++){var key=keys[i].slice(pref.length);var cmd="";cmd=this.resolveAliasToScript(key);if(typeof cmd=="string"){cmds[key]=cmd+UrlCommandsProcessor.StatementDelimiter+qry.get(pref+key,0);}}return cmds;}return null;};